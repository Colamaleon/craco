language: java
install: true
jdk:
- openjdk8
- openjdk11
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
stages:
- name: build
- name: snapshot
  if: branch = master
- name: release
  if: branch = release
jobs:
  include:
  - stage: build
    script: "./gradlew build"
  - stage: snapshot
    script: "./gradlew publish -x test -Dsnapshot=true -Dnexus.user=$NEXUS_USER -Dnexus.key=$NEXUS_KEY
      -Dbuild.number=$TRAVIS_BUILD_NUMBER"
  - stage: release
    script: "./gradlew publish -x test -Dnexus.user=$NEXUS_USER -Dnexus.key=$NEXUS_KEY
      -Dbuild.number=$TRAVIS_BUILD_NUMBER"
deploy:
  provider: releases
  api_key:
    secure: mFsMtGWZt/W50QoK1V3ANYdpweML7VP5XbuRTxusB0VQ/eySBfQ5oLu/HLy5reQ6Mx4+iqv1RksAZnXQhb9eeK4jmoyyOQzr+X89LiU71eyb9jmfIHKDHfoHlQ0UnnbyXU+/uhQ9ABT4fiUYlfKqptNrzA5JnIFuQIb9HW35yXc1Ab97PU1Zcb+PnuFm7v3TmwHvq8kwT6fhsvU7+MryWOqQAF3+a3qLtwsrIqNBeSNfFnJiItC3lBID9MlaST5R4KcsbQK7ixklWnoBBPYmJYX4INYXH1UbHvyuG5Tu2SXhPHrmHRArMOLht2KpLrltNTNYE8P+c7sTFp9YEVeRVQNrYKtQjIGqdlwbWpd9wU7Q/9oe7AlyB8b9HyNP9G4uLAoPcWraEZmPFHoUWnRDc9lPavzy1cgubpuvsN+tV74BUK30I9yxL6psjrxzqVuwDPEVQRglxizKQr7P+xz0lqRnJljb9JX5ouVEUxBCkQAY6+K2pIutkzj/cMXuY9CPtmEwXV4hc5+ZhL2rk7BzPUPITfE6XC5pwCeoXPaNLm1YmT2G5gDqlJAjs2UxcsuCgL+oCREEq0emlx/99ygeZSpYXFtcO8cHMRCLdO2DO25+Sq+VJB5Jo8PgRhkg8p/mkzJzbT94moZXFmKddsXjWhH+YCwZUv8nm5wpneDJLDU=
  file_glob: true
  file: build/libs/*
  skip_cleanup: true
  on:
    repo: upbcuk/upb.crypto.craco
    branch: release
