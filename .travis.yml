language: java
install: true
jdk:
- openjdk8
- openjdk11
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
stages:
- name: build
- name: snapshot
  if: branch = master
- name: release
  if: branch = release
jobs:
  include:
  - stage: build
    script: "./gradlew build"
  - stage: snapshot
    script: "./gradlew publish -x test -Dsnapshot=true -Dnexus.user=$NEXUS_USER -Dnexus.key=$NEXUS_KEY
      -Dbuild.number=$TRAVIS_BUILD_NUMBER"
  - stage: release
    script: "./gradlew publish -x test -Dnexus.user=$NEXUS_USER -Dnexus.key=$NEXUS_KEY
      -Dbuild.number=$TRAVIS_BUILD_NUMBER"
deploy:
  provider: releases
  api_key:
    secure: tUGR2HscfxlK81lWfjbGs02ooEl3JQoxNPdZJl5s6Ma6p9EjbvGEiOb0d7U6ZkjXVxl5yXmL7w+VxE7Hkhx5IG7qXgSjP4hBqTuVYRXn06jBNU45UFU2TGIsgIcDaLL8uM/r8h1rx9JYDz7UPk1HGEeaMG7+HqP5ttatSA1ACk4YhBXoVyLP3zJDLR3HzG/WrTq85v7aP5sP6raC5ZukRa0mKzCxFaEcVBak8P0FvgcdDMcBjBgtV+wST6m6H1zbwJi7fiY+/WEQ+404fM/iaC0Gsk2ypqL6Jntl+NeLB3xA6OdGFVcguIXiWfzUTFld/cxUN4Cl4VRYY4xEouHfQ7wlqDjPlaqSPCQkf9BmeXcwDr5ANDGUwZtpBS0Ee44kXVXIwq1MV6m5UXwK2gRHzpGZS6Tpg1ly90a0SG0QtIgdFjvM9Vldi+W6W/cfyDTSOZTD/doqfFmuueoE6P5ic+KsmUkNwiHZZ+FBxHGxmm+vmZlbvIPFyY4+T6Lnr9GETcnfm0gguyinoKcgSOAOWa0KsROHtrTzZ+bX10RzShq9VWO/VPNy5XcmUhKhKdC31DotFcfGFZNxbKKvQl4NfYwSen62JRjDZI7MSbyT0d8qykX9DbmdqLuNW2Y8D3MfS3NJx5cg/TBbjWALnjq3SstAmIaPDg2LfD0dNI9ogMc=
  file_glob: true
  file: build/libs/*
  skip_cleanup: true
  on:
    repo: upbcuk/upb.crypto.craco
    branch: release
